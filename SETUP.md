# üöÄ Setup Guide - Backend for SMM Preview Creator

## üìã –û–≥–ª—è–¥ –ø—Ä–æ–µ–∫—Ç—É

Backend API –¥–ª—è SMM Preview Creator - –¥–æ–¥–∞—Ç–æ–∫ –Ω–∞ –±–∞–∑—ñ NestJS –∑ MongoDB –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –≤ —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂–∞—Ö.

## ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

### –ö—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏:
1. ‚úÖ –ó–∞–º—ñ–Ω–µ–Ω–æ `Math.random()` –Ω–∞ `crypto.randomUUID()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó ID
2. ‚úÖ –í–∏–¥–∞–ª–µ–Ω–æ fallback –¥–ª—è JWT_SECRET - —Ç–µ–ø–µ—Ä –æ–±–æ–≤'—è–∑–∫–æ–≤–∞ –∑–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è
3. ‚úÖ –î–æ–¥–∞–Ω–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é file uploads (—Ç–∏–ø, —Ä–æ–∑–º—ñ—Ä, –±–µ–∑–ø–µ–∫–∞)
4. ‚úÖ –î–æ–¥–∞–Ω–æ rate limiting (100 –∑–∞–ø–∏—Ç—ñ–≤/—Ö–≤–∏–ª–∏–Ω—É)

### –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:
5. ‚úÖ –î–æ–¥–∞–Ω–æ —ñ–Ω–¥–µ–∫—Å–∏ –¥–æ –≤—Å—ñ—Ö MongoDB schemas
6. ‚úÖ –î–æ–¥–∞–Ω–æ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—é –¥–ª—è Projects —Ç–∞ Templates
7. ‚úÖ –î–æ–¥–∞–Ω–æ MongoDB —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –¥–ª—è deleteProject

### –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ:
8. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫ OAuth
9. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ logout –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –æ—á–∏—â–µ–Ω–Ω—è–º –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö —Å–µ—Å—ñ–π
10. ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ .env.example —Ñ–∞–π–ª

---

## üõ†Ô∏è –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 1. –ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π (—è–∫—â–æ —â–µ –Ω–µ –∑—Ä–æ–±–∏–ª–∏)

```bash
cd backend-for-smm
```

### 2. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```bash
npm install
```

### 3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è

–°–∫–æ–ø—ñ—é–π—Ç–µ `.env.example` –≤ `.env`:

```bash
copy .env.example .env
```

**–í–ê–ñ–õ–ò–í–û!** –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
# Database
MONGO_URL=mongodb://localhost:27017/smm-backend

# JWT (–û–ë–û–í'–Ø–ó–ö–û–í–û! –ú—ñ–Ω—ñ–º—É–º 32 —Å–∏–º–≤–æ–ª–∏)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-min-32-characters

# Server
PORT=5050
NODE_ENV=development

# CORS
CORS_ORIGINS=http://localhost:3000,http://localhost:5050

# AI
GPT_LLM_KEY=your-openai-api-key
```

### 4. –ó–∞–ø—É—Å—Ç—ñ—Ç—å MongoDB

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ MongoDB –∑–∞–ø—É—â–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –∞–±–æ —É Docker:

```bash
# Docker
docker run -d -p 27017:27017 --name mongodb mongo:latest

# –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ MongoDB Atlas (cloud)
```

### 5. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
# Development
npm run start:dev

# Production build
npm run build
npm run start:prod
```

---

## üîê –ë–µ–∑–ø–µ–∫–∞

### JWT Secret
**–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û!** 
- JWT_SECRET –º–∞—î –±—É—Ç–∏ –º—ñ–Ω—ñ–º—É–º 32 —Å–∏–º–≤–æ–ª–∏
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ –±–µ–∑–ø–µ—á–Ω–∏–π —Ä–∞–Ω–¥–æ–º–Ω–∏–π —Ä—è–¥–æ–∫
- –ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º–º—ñ—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ git

–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç—É:

```bash
# Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# PowerShell
[System.Convert]::ToBase64String([System.Security.Cryptography.RandomNumberGenerator]::GetBytes(32))
```

### Rate Limiting
- 100 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É –∑ –æ–¥–Ω–æ–≥–æ IP
- –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è –≤ `src/app.module.ts`

### File Upload Security
- –¢—ñ–ª—å–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è: JPEG, PNG, GIF, WebP, SVG
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä: 10MB
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è —ñ–º–µ–Ω —Ñ–∞–π–ª—ñ–≤

---

## üìö API Endpoints

### Authentication
- `POST /api/auth/register` - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
- `POST /api/auth/login` - –í—Ö—ñ–¥
- `POST /api/auth/session` - OAuth —Å–µ—Å—ñ—è
- `GET /api/auth/me` - –ü–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
- `POST /api/auth/logout` - –í–∏—Ö—ñ–¥

### Projects (–∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é)
- `GET /api/projects?page=1&limit=20` - –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç—ñ–≤
- `POST /api/projects` - –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç
- `GET /api/projects/:id` - –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç
- `DELETE /api/projects/:id` - –í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç

### Templates (–∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é)
- `GET /api/templates?page=1&limit=20&projectId=xxx` - –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω—ñ–≤
- `POST /api/templates` - –°—Ç–≤–æ—Ä–∏—Ç–∏ —à–∞–±–ª–æ–Ω
- `GET /api/templates/:id` - –û—Ç—Ä–∏–º–∞—Ç–∏ —à–∞–±–ª–æ–Ω
- `PATCH /api/templates/:id` - –û–Ω–æ–≤–∏—Ç–∏ —à–∞–±–ª–æ–Ω
- `DELETE /api/templates/:id` - –í–∏–¥–∞–ª–∏—Ç–∏ —à–∞–±–ª–æ–Ω

### Media
- `POST /api/media/upload` - –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª
- `GET /api/media/:id` - –û—Ç—Ä–∏–º–∞—Ç–∏ —Ñ–∞–π–ª
- `GET /api/media` - –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª—ñ–≤

### AI
- `POST /api/ai/generate-text` - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–µ–∫—Å—Ç—É
- `POST /api/ai/generate-image` - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è

### Exports
- `POST /api/exports` - –°—Ç–≤–æ—Ä–∏—Ç–∏ –µ–∫—Å–ø–æ—Ä—Ç
- `GET /api/exports/:id/status` - –°—Ç–∞—Ç—É—Å –µ–∫—Å–ø–æ—Ä—Ç—É

### Subscription
- `GET /api/subscription` - –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—ñ–¥–ø–∏—Å–∫—É

---

## üóÑÔ∏è MongoDB –Ü–Ω–¥–µ–∫—Å–∏

–í—Å—ñ schemas —Ç–µ–ø–µ—Ä –º–∞—é—Ç—å –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏:

### Users
- `id` (unique)
- `email` (unique)
- `oauth_id`
- Composite: `{email, oauth_id}`

### Projects
- `id` (unique)
- `user_id`
- Composite: `{user_id, created_at}`
- Composite: `{user_id, updated_at}`

### Templates
- `id` (unique)
- `user_id`
- `project_id`
- Composite: `{user_id, project_id}`
- Composite: `{user_id, created_at}`

### Sessions
- `id` (unique)
- `session_token` (unique)
- `user_id`
- `expires_at` (TTL index - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è)

---

## üìä –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è

–í—Å—ñ —Å–ø–∏—Å–∫–∏ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å –ø–∞–≥—ñ–Ω–∞—Ü—ñ—é:

**–ó–∞–ø–∏—Ç:**
```
GET /api/projects?page=2&limit=10
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "projects": [...],
  "pagination": {
    "page": 2,
    "limit": 10,
    "total": 45,
    "totalPages": 5
  }
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `page` - –Ω–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–º—ñ–Ω—ñ–º—É–º 1, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 1)
- `limit` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (–º—ñ–Ω—ñ–º—É–º 1, –º–∞–∫—Å–∏–º—É–º 100, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 20)

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
# Unit tests
npm run test

# E2E tests
npm run test:e2e

# Test coverage
npm run test:cov
```

---

## üêõ Debugging

```bash
npm run start:debug
```

–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ –ø–æ—Ä—Ç—É 9229 —É VSCode –∞–±–æ Chrome DevTools.

---

## üìù –õ–æ–≥–∏

–í—Å—ñ –ø–æ–º–∏–ª–∫–∏ OAuth, file uploads —Ç–∞ —ñ–Ω—à—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è —É –∫–æ–Ω—Å–æ–ª—å.

**TODO:** –î–æ–¥–∞—Ç–∏ Winston –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è.

---

## üö¢ Production Deployment

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ—î–º:

1. **–°—Ç–≤–æ—Ä—ñ—Ç—å production .env:**
   - –ë–µ–∑–ø–µ—á–Ω–∏–π JWT_SECRET (64+ —Å–∏–º–≤–æ–ª—ñ–≤)
   - Production MongoDB URL (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ MongoDB Atlas)
   - NODE_ENV=production
   - –ù–∞–ª–∞—à—Ç—É–π—Ç–µ CORS_ORIGINS –¥–ª—è –≤–∞—à–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

2. **–ó–±—ñ–ª–¥—ñ—Ç—å –ø—Ä–æ–µ–∫—Ç:**
   ```bash
   npm run build
   ```

3. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å:**
   ```bash
   npm run start:prod
   ```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:

- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ PM2 –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å–∞–º–∏
- –ù–∞–ª–∞—à—Ç—É–π—Ç–µ NGINX —è–∫ reverse proxy
- –£–≤—ñ–º–∫–Ω—ñ—Ç—å HTTPS (Let's Encrypt)
- –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ (New Relic, DataDog)
- –†–µ–≥—É–ª—è—Ä–Ω—ñ –±–µ–∫–∞–ø–∏ MongoDB

---

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ MongoDB –∑–∞–ø—É—â–µ–Ω–æ
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
4. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ –ø–æ—Ä—Ç 5050 –Ω–µ –∑–∞–π–Ω—è—Ç–∏–π

---

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

UNLICENSED (–ø—Ä–∏–≤–∞—Ç–Ω–∏–π –ø—Ä–æ–µ–∫—Ç)

---

**–£—Å–ø—ñ—à–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏! üéâ**

